ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = lims,
oob = squish,
name = "PR (MPa)"
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.title = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
legend.position = "right",
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3)
)
p_depths
p_depths %>% add_square_axes(flip_rows = FLIP_ROWS)
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = lims,
oob = squish,
name = "PR (MPa)"
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.title = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
legend.position = "right",
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3)
)
p_depths
ggsave(filename = "figures/kriged_hectare.png",
plot = p_depths, dpi = 300, width = 10, height = 6)
ggsave(filename = paste0(plot_dir, "kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
ggsave(filename = paste0(plot_dir, "figures/kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
ggsave(filename = paste0(plot_dir, "kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
library(scales)
x_breaks <- seq(
floor(min(df_plot$field_x) / 500) * 500,
ceiling(max(df_plot$field_x) / 500) * 500,
by = 500
)
y_breaks <- seq(
floor(min(df_plot$field_y) / 500) * 500,
ceiling(max(df_plot$field_y) / 500) * 500,
by = 500
)
lab_m <- function(x) x / 100
depths_use <- c(10, 20, 30, 40, 50, 60, 70, 80)
df_plot <- krige_best %>% filter(depth %in% depths_use)
lims <- range(df_plot$pr_pred, na.rm = TRUE)
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = lims,
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
)
p_depths
x_breaks <- seq(
floor(min(df_plot$field_x) / 500) * 500,
ceiling(max(df_plot$field_x) / 500) * 500,
by = 1000
)
y_breaks <- seq(
floor(min(df_plot$field_y) / 500) * 500,
ceiling(max(df_plot$field_y) / 500) * 500,
by = 1000
)
lab_m <- function(x) x / 100
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = lims,
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
)
p_depths
ggsave(filename = paste0(plot_dir, "kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
upper <- ceiling(lims[2] * 10) / 10  # round up to 0.1 MPa
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = lims,
limits = c(0, upper),
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
)
p_depths
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = c(0, upper),
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
)
p_depths
ggsave(filename = paste0(plot_dir, "kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
+ geom_vline(xintercept = x_breaks, colour = "grey85", linewidth = 0.2) +
geom_hline(yintercept = y_breaks, colour = "grey85", linewidth = 0.2)
p_depths +
geom_vline(xintercept = x_breaks, colour = "grey85", linewidth = 0.2) +
geom_hline(yintercept = y_breaks, colour = "grey85", linewidth = 0.2)
ggsave(filename = paste0(plot_dir, "kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = c(0, upper),
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
) +
geom_vline(xintercept = x_breaks, colour = "grey85", linewidth = 0.2) +
geom_hline(yintercept = y_breaks, colour = "grey85", linewidth = 0.2)
p_depths
ggsave(filename = paste0(plot_dir, "kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = c(0, upper),
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
)
p_depths
ggsave(filename = paste0(plot_dir, "kriged_hectare.png"),
plot = p_depths, dpi = 300, width = 10, height = 6)
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = c(0, upper),
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
) +
geom_vline(xintercept = x_breaks, colour = "grey85", linewidth = 0.2) +
geom_hline(yintercept = y_breaks, colour = "grey85", linewidth = 0.2)
p_depths
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = c(0, upper),
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
) +
geom_vline(xintercept = 500, colour = "grey85", linewidth = 0.2) +
geom_hline(yintercept = 500, colour = "grey85", linewidth = 0.2)
p_depths
View(add_square_axes)
p_depths_sq <- add_square_axes(p_depths)
p_depths_sq
p_depths_sq <- add_square_axes(
p_depths,
square_size = 500,
origin_x = 0,
origin_y = 0,
n_cols = 20,
n_rows = 20,
flip_rows = FALSE   # IMPORTANT: match how you computed field_y
)
p_depths_sq
p_depths <- ggplot(df_plot, aes(field_x, field_y, fill = pr_pred)) +
geom_tile() +
coord_equal(expand = FALSE) +
facet_wrap(
~ depth,
ncol = 4,
labeller = labeller(depth = function(d) paste0(d, " cm"))
) +
scale_fill_viridis_c(
option = "inferno",
limits = c(0, upper),
oob = scales::squish,
name = "PR (MPa)"
) +
scale_x_continuous(
breaks = x_breaks,
labels = lab_m
) +
scale_y_continuous(
breaks = y_breaks,
labels = lab_m
) +
labs(
title = "Kriged penetration resistance",
subtitle = "Depth slices across sampled blocks in the 1 ha field",
x = "Field X position (m)",
y = "Field Y position (m)"
) +
theme_bw() +
theme(
panel.grid = element_blank(),
axis.text = element_text(size = 8),
axis.title = element_text(face = "bold"),
strip.background = element_rect(fill = "grey95", colour = NA),
strip.text = element_text(face = "bold"),
panel.border = element_rect(colour = "grey30", fill = NA, linewidth = 0.3),
legend.position = "right"
)
p_depths
p_depths_sq <- add_square_axes(
p_depths,
square_size = 500,
origin_x = 0,
origin_y = 0,
n_cols = 20,
n_rows = 20,
flip_rows = FALSE   # IMPORTANT: match how you computed field_y
)
p_depths_sq
source("R/add_square_axes.R")
p_depths
p_depths_sq <- add_square_axes(
p_depths,
square_size = 500,
origin_x = 0,
origin_y = 0,
n_cols = 20,
n_rows = 20,
flip_rows = FALSE   # IMPORTANT: match how you computed field_y
)
p_depths_sq
source("R/add_square_axes.R")
p_depths_sq <- add_square_axes(
p_depths,
square_size = 500,
origin_x = 0,
origin_y = 0,
n_cols = 20,
n_rows = 20,
flip_rows = FALSE   # IMPORTANT: match how you computed field_y
)
p_depths_sq
ggsave(filename = paste0(plot_dir, "kriged_hectare_grid.png"),
plot = p_depths_sq, dpi = 300, width = 10, height = 6)
